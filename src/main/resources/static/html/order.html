<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" href="../css/order.css" />
		<script type="text/javascript" src="../js/main2.js" ></script>
		<style>
			.layui-disabled, .layui-disabled:hover {
				color: #999!important;
				cursor: not-allowed!important;
			}
            .layui-radio-disbaled>i {
                color: #5FB878!important;
            }

		</style>
	</head>
	<body onload="IFrameResize('myframe')">
		<!--step2 progress-->
		<div class="step2-progress-box">
		    <div class="progress-percent"></div>
		    <div class="progress-icon">
		        <span class="progress-firsticon">1</span>
		        <span class="progress-secondicon">2</span>
		        <span class="progress-thirdicon">3</span>
		    </div>
		    <div class="progress-text">
		        <span class="progress-firsttext">挑选车型</span>
		        <span class="progress-secondtext">填写与核对订单</span>
		        <span class="progress-thirdtext">成功提交</span>
		    </div>
		</div>
		<!--step2 progress-->
		<div class="step2-wrap">
		    <div class="step2-box">
		        <!--step2 left start-->
		        
		        <form id="myform" class="layui-form">
		        	
		        <div class="step2-box-left">
		           
		                <!--step2 车型门店信息 start-->
		                
					<div class="order-info-box">
					    <div class="car-image-box">
					        <img id="myimg" src="https://image.1hai.cn/front/activity/20160909/lavida.jpg" alt="大众朗逸" />
					        <span>租 期：<em>2</em>天</span>
					    </div>
					    <div class="store-info-box">
					        <div class="car-name">
					
					            <a href="#" onclick="javascript :history.back(-1);" title="返回修改">返回修改</a>
					
					            <label id="nameCar">大众朗逸或同组车型</label>           <em onmouseover="javascript :$('.carmodel-box').removeClass('layui-hide')" onmouseleave="$('.carmodel-box').addClass('layui-hide')" class="sp-box sp-carmodel">车辆说明</em>
					
					        </div>
					        <ul>
					
					            <li><span class="store-title">取车地点</span><span class="store-title">还车地点</span></li>
					            <li><span id="city">取车门店：极速租车（大学城店）</span><span id="city2">还车门店：极速租车（大学城店）</span></li>
					            <li><span id="time">取车时间：2018-05-07 00:00:00</span><span id="time2">还车时间：2018-05-09 00:00:00</span></li>
					            <li><span id="province">取车地址：重庆市-重庆市-沙坪坝区</span><span id="province2">还车地址：重庆市-重庆市-沙坪坝区</span></li>
					            <li style="padding-top: 5px;"><span class="store-title">订单说明：</span></li>
					            <li class="rule-toggle"><a data-method="notice" id="gz">退改规则</a>不限公里数，超时费按车辆租赁费及门店服务费均价÷6收取实际超期小时费 (部分0元活动订单，按照40元/小时进行收取)。</li>
					                
					        </ul>
					    </div>
					</div>
					
					
					<div id="tggz"  class="layui-hide">
					    <div class="book-rule" style="padding: 50px; line-height: 22px; background-color: #393D49; color: #fff; font-weight: 300;">
					        <h3>一、普通车型退改规则</h3>
					        <div class="ruleinfo">
					            <ul>
					                <li>
					                    <p class="rule-lgbt">1、适用范围</p>
					                    <ol style="color: #eb5c00;">
					                        <li>a) 此规则仅限平日适用，春节、国庆等法定节假日请以具体公示的活动页为准；</li>
					                        <li>b) 此规则仅限普通车型使用，高端车型请下拉查看具体规则。</li>
					                    </ol>
					                </li>
					                <li>
					                    <p class="rule-lgbt">2、订单取消</p>
					                    <ol>
					                        <li>a) 预订取车时间前48小时外取消订单，预付订单金额将全额退款。</li>
					                        <li>b) 预订取车时间前48小时内取消订单，一嗨将收取最低一日日租金作为违约金，剩余已预付的订单金额将全部退还给客户。</li>
					                        <li>c）天气不可抗力（比如洪水、地震等自然灾害）导致用户取消订单，不扣除违约金。</li>
					                    </ol>
					                </li>
					                <li>
					                    <p class="rule-lgbt">3、订单修改</p>
					                    <ol>
					                        <li>a) 订单支付完成后，允许修改订单信息；</li>
					                        <li>b) 修改后订单金额可能发生变化，若修改后订单金额低于原来订单金额，差价将会在3-5个工作日原路径返还；若修改后订单金额高于原来订单金额，您可选择在线支付或取车时到店支付订单剩余金额。</li>
					                    </ol>
					                </li>
					                <li>
					                    <p class="rule-lgbt">4、续租</p>
					                    <p>取车后增加租期，视为续租，续租部分按照非预付优惠价计算。</p>
					                </li>
					            </ul>
					        </div>
					
					        <h3>二、高端车退改规则</h3>
					        <div class="ruleinfo">
					            <ul>
					                <li>
					                    <p class="rule-lgbt">1、订单取消</p>
					                    <ol>
					                        <li>a）若在取车前48-72小时取消，收取订单金额的15%作为违约金；</li>
					                        <li>b）若在取车前24-48小时取消，收取订单金额的50%作为违约金；</li>
					                        <li>c）若在取车前24小时内取消，收取订单金额100%作为违约金；</li>
					                        <li>d）天气不可抗力（比如洪水、地震等自然灾害）导致用户取消订单，不扣除违约金。</li>
					                    </ol>
					                </li>
					                <li>
					                    <p class="rule-lgbt">2、订单修改</p>
					                    <p>订单支付完成后，允许修改订单信息：</p>
					                    <ol>
					                        <li>a）若在取车前48-72小时修改，收取订单金额的10%作为改签费；</li>
					                        <li>b）若在取车前24-48小时修改，收取订单金额的25%作为改签费；</li>
					                        <li>c）若在取车前24小时内修改，收取订单金额50%作为改签费；</li>
					                        <li>d）天气不可抗力（比如洪水、地震等自然灾害）导致用户修改订单，不扣除改签费。</li>
					                    </ol>
					                </li>
					                <li>
					                    <p class="rule-lgbt">3、提前还车</p>
					                    <p>允许提前还车，但已预付的租金不退。</p>
					                </li>
					            </ul>
					        </div>
					    </div>
					</div>
		
		
					<div class="carmodel-box layui-hide" style="top: 110px; left: 591.3px;">
					    <div class="carmodel-top"></div>
					        <div class="carmodel-info">
					            <h3>车型组说明</h3>
					            <p>当您选择某个车型组时，您选择的是与所列举车型相类似的车型。</p>
					            <p>例如：当您选择预订“舒适型车类似大众朗逸”时，表示您选择的是与大众朗逸相类似的舒适型车。</p>
					            <p>需要注意的是，您在预订成功后，去门店取车时，取到的有可能是雪佛兰克鲁兹，也有可能是别克英朗GT，而不一定是大众朗逸。具体取到什么车型，要看您到门店取车时，您所预订的车型组相关车型的库存情况而定。</p>
					        </div>
					    <div class="carmodel-info">
					        <h3>车辆颜色说明</h3>
					        <p>车辆颜色请以门店为准，图片仅为车型示意图。</p>
					    </div>
					</div>
		
					
		
			        <!--step2 车型门店信息 end-->
			    
			        <div class="payment-box">
			            <div class="title">
			                支付方式
			            </div>
			            <div class="payment-list" id="orderPaymentList">
			            	<div class="layui-input-block" style="margin-left: -19px;">
						      <input type="radio" name="payMethodOrder"  value="门店支付" title="门店支付" checked>
						    </div>
			                
			            </div>
			        </div>

					<div class="payment-box">
						<div class="title">
							精彩活动
						</div>
						<div class="payment-list" id="activityPaymentList">
							<!--<div class="layui-input-block" style="margin-left: -19px;">
								<input type="radio" alt="123" name="idActivityOrder"  value="门店支付" title="门店支付" checked>
							</div>
							<div class="layui-input-block" style="margin-left: -19px;">
								<input type="radio" alt="456"  name="idActivityOrder" value="门店支付2" title="门店支付2" checked>
							</div>-->
						</div>
					</div>
			        <!--step2 支付方式 end-->
			        <!--step2 增值服务 start-->
		       
					<div class="service-box">
					    <div class="title">
					        其他服务
					    </div>
					    <div class="service-list">
					       
							<!--<div class="layui-input-block">
								<div class="service-name">
				                    <input name="myservice1" lay-filter="myservice1"  lay-skin="primary" type="checkbox" class="ba-analysis" title="指定车型" checked>
				                </div>
				                <div class="service-price">
				                    ￥10<i>/天</i>
				                </div>
							</div>

							<div class="layui-input-block">
								<div class="service-name">
	                                <input name="myservice2" lay-filter="myservice2" lay-skin="primary" type="checkbox" class="ba-analysis" title="车损免赔" checked>
	                            </div>
	                            <div class="service-price">
	                                ￥130<span></span>
	                            </div>
	                            <div class="service-des">
                                		客户如在租赁期间内购买车损免赔，则1500元以下本车车辆损伤无需赔偿
	                            </div>
							</div>

					        <div class="layui-input-block">
					        	<div class="service-name">
	                            	 <input name="myservice3" lay-filter="myservice3"  lay-skin="primary" type="checkbox" class="ba-analysis" title="增值保障服务" checked>
	                            </div>
	                            <div class="service-price">
	                                ￥50<span></span>
	                            </div>
	                            <div class="service-des">
                                		三者责任增加至50万
	                            </div>
					        </div>

					        <div class="layui-input-block">
					        	 <div class="service-name">
	                                <input name="myservice4" lay-filter="myservice4" lay-skin="primary" type="checkbox" class="ba-analysis" title="乘客座位保障" checked>
	                            </div>
	                            <div class="service-price">
	                                ￥50<span></span>
	                            </div>
	                            <div class="service-des">
	                               		车辆发生事故，致使乘客遭受人身伤亡造成的费用损失，以及为减少损失而支付的必要合理的施救、保护费用，赔付标准以保险公司核定为准且赔付上限不超过5万元/人/座。同时，在租赁期间，提供道路救援服务。
	                            </div>
					        </div>  -->
                   
					    </div>
					</div>
		
		            <!--step2 增值服务 end-->
		
		        </div>
		        
		        </form>	
		        <!--step2left end -->
		        <!--step2right start -->
		        <div class="step2-box-right" id="priceall">
		            
		
					<div class="price-detail">
					    <div class="title">
					        费用明细
					    </div>
					    <ul>
					        <li class="line-clear" id="baseRatePrice">						
							    <em class="price-mid">￥136</em>车辆租赁费及门店服务费					
					        </li>	
					        <!--基本保障服务费-->
			                <li>
			                    <em class="price-mid">￥80</em>基本保障服务费
			
			                    <span >基本保障服务费40.0元 / 天</span>
			                </li>

							<li id="myActivitySub">
								<em class="price-mid">￥80</em>满减活动
								<span >基本保障服务费40.0元 / 天</span>
							</li>

					        <li id="servicePriceList">
					            
					
								<em id="otherservice" class="price-drop">
								    ￥20 
								</em>其他服务费
					
							    <div class="price-drop-box" id="serviceList">
							            <span> 
							             	<p class="orange">￥20</p>
							                <p>手续费</p>
							            </span>
							            <span>
							                <p class="orange"> ￥20</p>
							                <p>车型指定费</p>
							            </span>
							            <span>
							                <p class="orange">￥130</p>
							                <p>车损免赔</p>
							            </span>
							            <span>
							                <p class="orange">￥50</p>
							                <p>三者责任增加至50万</p>
							            </span>
							            <span>
							                <p class="orange">￥50</p>
							                <p>乘客座位保障</p>
							            </span>
							    </div>
					
					        </li>

					    </ul>
					    <div class="deposit_box">
					        <p>预授权<em>（可退）</em><span>￥3000</span></p>
					        <p>违章押金<em>（可退）</em><span>￥2000</span></p>
					    </div>
					    <div class="price-box" id="totalAmount">
					        <span class="sub-load hidelable" id="priceloading"></span>
					<span class="price-txt"
					    id="priceTitle">总计:</span><span class="price-total" id="priceTotal"><em>￥</em>236</span>
					    </div>
					    <div >
					        <button id="submitForm" class="layui-btn layui-btn-fluid">提交订单</button>
					    </div>
					
					    <div class="price-help" style="margin-top: 10px;">
					
					        <p style="display:none; border-bottom: 1px dashed #EB5A01; padding-bottom: 5px; margin-bottom: 5px;"><b>此单可参加周年庆返现活动，您需支付整单金额，返还金额（基本租车费的50%）将在还车后3-5个工作日退还至您的一卡行账户</b></p>
					            
					                首次租车请使用本人信用卡，本人二代有效身份证，本人有效地方驾驶证正副本。<br />
					            
					
					        <p>本订单仅为客户租车预约登记，提交该订单后，客户需要到门店办理具体租车手续，具体权利义务以签署的合同为准。</p>
					    </div>
					
					    <div id="LimitRemind" style="border-top:1px solid #ccc; color: #EB5A01; background: #FFFCD2; padding: 15px; line-height:20px;display:none;"></div>
					
					</div>
		
		
		        </div>
		        <!--step2right end -->
		    </div>
		   
		</div>
	   
	   
	   
	   <script>
		var myorder=null;
		var myservice=null;
		var myactivity=null;
        function service(id){
            layer.msg("service:"+id);
            console.log(id);
        }

		layui.use(['form','layer'], function(){
		  form = layui.form,layer = layui.layer;
		  	  
		  $("#gz").click(function(){
		  	 //示范一个公告层
		      layer.open({
		        type: 1
		        ,title: false //不显示标题栏
		        ,closeBtn: false
		        ,area: ['500px', '600px']
				,offset: '20px'
		        ,shade: 0.8
		        ,id: 'LAY_layuipro' //设定一个id，防止重复弹出
		        ,btn: ['我知道了']
		        ,btnAlign: 'c'
		        ,moveType: 1 //拖拽模式，0或者1
		        ,content: $("#tggz").html()
		       
		      });
		  })


            $(function(){


                myorder=JSON.parse($.cookie("myorder"));
                //console.log(myorder);

                //将订单数据显示出来
				$(".car-image-box span em").html(myorder["dayOrder"]);
                $("#serviceList span p.orange").eq(1).html("￥"+(parseInt(myorder["dayOrder"])*10));
                $("#nameCar").html(myorder["nameCar"]);
                $("#city").html("取车门店："+myorder["city"]);
                $("#city2").html("还车门店："+myorder["city2"]);
                $("#time").html("取车时间："+myorder["getCarTimeOrder"])
                $("#time2").html("还车时间："+myorder["returnCarTimeOrder"])
				$("#province").html("取车地址："+myorder["province"])
				$("#province2").html("还车地址："+myorder["province2"])
				$("#myimg").attr("src",myorder["url"]);
				//基本保障服务费
                $(".price-mid").eq(1).html("￥"+40*myorder["dayOrder"]);
                //显示服务信息
                myservice=myajax("../OtherServiceTable/getOtherService","get");
                //console.log(myservice);
				var otherservice1=$(".service-list");
				otherservice1.empty();

				var otherservice2=$("#serviceList");
				otherservice2.empty();
				otherservice2.append('<span> \n' +
                    '\t\t\t\t\t\t\t             \t<p class="orange">￥20</p>\n' +
                    '\t\t\t\t\t\t\t                <p>手续费</p>\n' +
                    '\t\t\t\t\t\t\t            </span>');
                for(var i in myservice){

                    if(myservice[i].describeOtherService==null||myservice[i].describeOtherService=="")
					{
                        otherservice2.append('<span> \n' +
                            '\t\t\t\t\t\t\t             \t<p class="orange">￥'+myservice[i].priceOtherService*myorder["dayOrder"]+'</p>\n' +
                            '\t\t\t\t\t\t\t                <p>'+myservice[i].nameOtherService+'</p>\n' +
                            '\t\t\t\t\t\t\t            </span>');
                        otherservice1.append('<div class="layui-input-block">\n' +
                            '\t\t\t\t\t\t\t\t<div class="service-name">\n' +
                            '\t\t\t\t                    <input  name="idOtherServiceOrder" alt="'+i+'" lay-filter="myservice'+i+'" lay-skin="primary" type="checkbox" class="ba-analysis" value="'+myservice[i].nameOtherService+'" title="'+myservice[i].nameOtherService+'" checked>\n' +
                            '\t\t\t\t                </div>\n' +
                            '\t\t\t\t                <div class="service-price">\n' +
                            '\t\t\t\t                    ￥'+myservice[i].priceOtherService+'<i>/天</i>\n' +
                            '\t\t\t\t                </div>\n' +
                            '\t\t\t\t\t\t\t</div>');
					}else{
                        otherservice2.append('<span> \n' +
                            '\t\t\t\t\t\t\t             \t<p class="orange">￥'+myservice[i].priceOtherService+'</p>\n' +
                            '\t\t\t\t\t\t\t                <p>'+myservice[i].nameOtherService+'</p>\n' +
                            '\t\t\t\t\t\t\t            </span>');
                        otherservice1.append('<div class="layui-input-block">\n' +
                            '\t\t\t\t\t\t\t\t<div class="service-name">\n' +
                            '\t                                <input  name="idOtherServiceOrder" alt="'+i+'" lay-filter="myservice'+i+'" lay-skin="primary" type="checkbox" class="ba-analysis" value="'+myservice[i].nameOtherService+'" title="'+myservice[i].nameOtherService+'" checked>\n' +
                            '\t                            </div>\n' +
                            '\t                            <div class="service-price">\n' +
                            '\t                                ￥'+myservice[i].priceOtherService+'<span></span>\n' +
                            '\t                            </div>\n' +
                            '\t                            <div class="service-des">\n' +myservice[i].describeOtherService+
                            '\t                            </div>\n' +
                            '\t\t\t\t\t\t\t</div>');
					}

                    form.on('checkbox(myservice'+i+')', function(data){
                        var myi=data.elem.alt;
                        if(data.elem.checked)
                            $("#serviceList span").eq(++myi).removeClass('layui-hide');
                        else
                            $("#serviceList span").eq(++myi).addClass('layui-hide');
                        changePrice();
                    });
                    //form.render();
				}


				//显示活动信息
                myactivity=myajax("../ActivityTable/getActivity","get");
                var activityservice=$("#activityPaymentList");
                activityservice.empty();

                for(var i in myactivity){
                    var content=myactivity[i].nameActivity+'满'+myactivity[i].achieveActivity+'减'+myactivity[i].subActivity;
                    activityservice.append('<div class="layui-input-block" style="margin-left: -19px;">\n' +
                        '\t\t\t\t\t\t\t\t<input type="radio" disabled alt="'+myactivity[i].idActivity+'"  name="idActivityOrder"  value="'+content+'" title="'+content+'">\n' +
                        '\t\t\t\t\t\t\t</div>');
				}
                changePrice();
				form.render();
                IFrameResize('myframe')
            })

            $("#submitForm").click(function(){
		        if($.cookie("myuser")==undefined)
				{
				    layer.msg("请先登录，再进行操作")
				}
				else{
                    var mydate=$("#myform").serializeArray();
                    mydate=alterSerializeArrayToJson(mydate);
                    mydate["idActivityOrder"]=$("input[name='idActivityOrder']").val();
                    mydate["priceOrder"]=$("#priceTotal").html().substring(10);
                    mydate["idOtherServiceOrder"]=mydate["idOtherServiceOrder"].join(",");
                    mydate["idUserOrder"]=JSON.parse($.cookie("myuser")).idUser;
                    mydate["stateOrder"]="待支付";
                    $.extend(mydate, myorder);

                    //console.log(mydate)
                    //console.log($("#priceTotal").html().substring(10))

                    var result=myajax2("../OrderTable/saveOrder","post",mydate);
                    layer.msg("订单提交成功，订单编号为"+result.uuid+"<br>详情请在我的订单中查看！")

                    countDown(3,"../html/cars.html");
				}

		    })
		    
		    function changePrice(){
		    	var ss=$("#myform").serialize()
		     	var price1=parseInt($(".price-mid").html().substring(1));
		     	var price2=parseInt($(".price-mid").eq(1).html().substring(1));
		     	var price=price1+price2;
		     	var otherservice=0;
                var myservicelist=$("#serviceList span[class!=layui-hide]");
				for(var i=0;i<myservicelist.length;i++)
				{
				    //.split("￥")[1].split("</p>")
				    //console.log(myservicelist.eq(i).html().split("￥")[1].split("</p>")[0])
					otherservice+=parseInt(myservicelist.eq(i).html().split("￥")[1].split("</p>")[0]);
				}
		     	price+=otherservice;


                for(var i=myactivity.length-1;i>=0;i--){
					if(price>=myactivity[i].achieveActivity){
					    //console.log(price+"  "+myactivity[i].achieveActivity);
                        price-=myactivity[i].subActivity;
                        $("input[alt='"+myactivity[i].idActivity+"'][name='idActivityOrder']").prop("checked","checked");
						$("#myActivitySub em").html("￥-"+myactivity[i].subActivity);
                        $("#myActivitySub span").html(myactivity[i].nameActivity+'满'+myactivity[i].achieveActivity+'减'+myactivity[i].subActivity);
                        form.render();
                        break;
					}
                }
                $("#otherservice").html("￥"+otherservice);
                $("#priceTotal").html("<em>￥</em>"+price);
		    }

		  
		});
	</script>
	</body>
</html>
