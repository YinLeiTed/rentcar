<!DOCTYPE html>
<html>
<head>
<title>Cars</title>
<link rel="stylesheet" href="../css3/bootstrap.min.css">
<link rel="stylesheet" href="../css3/bootstrap-select.css">
<link href="../css3/style.css" rel="stylesheet" type="text/css" media="all" />
<!--价格样式-->
<link rel="stylesheet" type="text/css" href="../css3/jquery-ui1.css">

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords" content="Resale Responsive web template, Bootstrap Web Templates, Flat Web Templates, Android Compatible web template, 
Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, Sony Ericsson, Motorola web design" />
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>

<script type="text/javascript" src="../js3/jquery.min.js"></script>

<script src="../js3/bootstrap.min.js"></script>
<script src="../js3/bootstrap-select.js"></script>

<link href="../css3/jquery.uls.css" rel="stylesheet"/>
<link href="../css3/jquery.uls.grid.css" rel="stylesheet"/>
<link href="../css3/jquery.uls.lcd.css" rel="stylesheet"/>

<script type="text/javascript" src="../layui/layui.js" ></script>
<link rel="stylesheet" href="../layui/css/layui.css" />
<script type="text/javascript" src="../js/area.js" ></script>
<script type="text/javascript" src="../js/iframe.js" ></script>
	<script type="text/javascript" src='../js/jquery.cookie.js'></script>
	<script type="text/javascript" src='../js/myajax.js'></script>
	<link rel="stylesheet" href="../css/order.css" />
  <style>
	#city+.layui-form-select dl dd,#city2+.layui-form-select dl dd{
		padding: 0 10px;
		line-height: 36px;
		white-space: nowrap;
		overflow: hidden;
		text-overflow: ellipsis;
		width: 100%;
		float: left;
	}
  	.layui-form-select dl dd{
  		padding: 0 10px;
	    line-height: 36px;
	    white-space: nowrap;
	    overflow: hidden;
	    text-overflow: ellipsis;
	    width: 100px;
	    float: left;
  	}
  	.layui-form-select dl dt{
  		padding: 0 10px;
	    line-height: 36px;
	    white-space: nowrap;
	    overflow: hidden;
	    text-overflow: ellipsis;
	    width: 100%;
	    float: left;
  	}
	.layui-form-select dl dd.layui-disabled{
		width: 100%;
		font-size: 20px;
		background-color: #36b5e7;
	}
	#province+div dl.layui-anim-upbit,#province2+div dl.layui-anim-upbit {
		-webkit-animation-name: layui-upbit;
		animation-name: layui-upbit;
		width: 800px ;
	}
  	.term {
	    padding: 12px 0 5px;
	    background: #f5f5f5;
	    border: 1px solid #ccc;
	}
  </style>
	
<script type="text/javascript">
$(document).ready(function () {    
var elem=$('#container ul');      
	$('#viewcontrols a').on('click',function(e) {
		if ($(this).hasClass('gridview')) {
			elem.fadeOut(1000, function () {
				$('#container ul').removeClass('list').addClass('grid');
				$('#viewcontrols').removeClass('view-controls-list').addClass('view-controls-grid');
				$('#viewcontrols .gridview').addClass('active');
				$('#viewcontrols .listview').removeClass('active');
				elem.fadeIn(1000);
			});						
		}
		else if($(this).hasClass('listview')) {
			elem.fadeOut(1000, function () {
				$('#container ul').removeClass('grid').addClass('list');
				$('#viewcontrols').removeClass('view-controls-grid').addClass('view-controls-list');
				$('#viewcontrols .gridview').removeClass('active');
				$('#viewcontrols .listview').addClass('active');
				elem.fadeIn(1000);
			});									
		}
	});
});
</script>
</head>
<body onload="IFrameResize('myframe')">
<div class="header" style="margin-top: 20px;">
	<!--step2 progress-->
	<div class="step2-progress-box2">
		<div class="progress-percent2"></div>
		<div class="progress-icon">
			<span class="progress-firsticon">1</span>
			<span class="progress-secondicon2">2</span>
			<span class="progress-thirdicon">3</span>
		</div>
		<div class="progress-text">
			<span class="progress-firsttext">挑选车型</span>
			<span class="progress-secondtext2">填写与核对订单</span>
			<span class="progress-thirdtext">成功提交</span>
		</div>
	</div>
	<!--step2 订单状态-->
	<!--<div class="step2-progress-box2">
        <div class="progress-percent3"></div>
        <div class="progress-icon">
            <span class="progress-firsticon">1</span>
            <span class="progress-secondicon">2</span>
            <span class="progress-thirdicon3">3</span>
        </div>
        <div class="progress-text">
            <span class="progress-firsttext">挑选车型</span>
            <span class="progress-secondtext">填写与核对订单</span>
            <span class="progress-thirdtext3">成功提交</span>
        </div>
    </div>-->

    <div class="container">
    	<form id="myform" class="layui-form term">
		<div class="layui-form-item">
		    <label class="layui-form-label" style="width: 90px;">取车地点</label>
		    <div class="layui-input-inline" style="width: 320px;">
		      <select id="province" name="province" lay-filter="province" required lay-verify="required" lay-search>
		        	
		      </select>     
		    </div>
		    <div class="layui-input-inline">
		      <select id="city" name="idGetCarOrder" lay-filter="city"  required  lay-verify="required" lay-search>
		      </select>
		    </div>
		    
		    <label class="layui-form-label" style="width: 160px;">取车时间~还车时间</label>
		     <div class="layui-input-inline">
		        <input type="text" name="time" class="layui-input" id="time" style="width: 300px;" required lay-verify="required">
		      </div>
		    
		    
		</div>
		<div class="layui-form-item">   
		    <label class="layui-form-label" style="width: 90px;">还车地点</label>
		    <div class="layui-input-inline" style="width: 320px;">
		      <select id="province2" name="province2" lay-filter="province2" required lay-verify="required" lay-search>
		        	
		      </select>     
		    </div>
		    <div class="layui-input-inline">
		      <select id="city2" name="idReturnCarOrder" lay-filter="city2"  required lay-verify="required" lay-search>
		      </select>
		    </div>
		    
		     <div class="layui-input-inline left layui-hide">
		       	<button id="mysubmit" class="layui-btn" lay-submit lay-filter="formDemo" style="margin-left: 30px;">查询</button>
		     </div>
		</div>
		
		
	</form>
    </div>
	
	<script>
		var idCarOrder=null;
		var nameCar=null;
		var urlCar=null;
        var mycarresult=null;
        function enterOrder(id,name,url)
        {
            idCarOrder=id;
            nameCar=name;
            urlCar=url;
            $("#mysubmit").click();
        }
        function carSearch() {
            if(mycarresult==null)
                layer.msg("请先选择租车城市和租车门店！");
            else if(mycarresult.length!=0){
                var range=$("#amount").val().split(" - ");
                var price1=parseInt(range[0].substr(1));
                var price2=parseInt(range[1].substr(1));
                var brand=$("#brandCar").val();

                var mycarlist=$("#mycarlist");
                mycarlist.empty();
                var mycity=$("#city option:selected").html();
                for(var i in mycarresult)
                {
					if((mycarresult[i].brandTypeCar==brand||brand=="所有品牌")&&mycarresult[i].dailyRentCar>=price1&&mycarresult[i].dailyRentCar<=price2)
					{
                        mycarlist.append('<a onclick="enterOrder('+mycarresult[i].idCar+')">\n' +
                            '                <li>\n' +
                            '                <img src="'+mycarresult[i].imgCar+'" title="" alt="" />\n' +
                            '                <section class="list-left">\n' +
                            '                <h5 class="title">'+mycarresult[i].nameCar+'</h5>\n' +
                            '                <span class="cityname">'+mycarresult[i].describeCar+'</span>\n' +
                            '            <p class="catpath">'+mycarresult[i].carTypeCar+'&nbsp;&nbsp;'+mycity+'</p>\n' +
                            '            </section>\n' +
                            '            <section class="list-right">\n' +
                            '                <span class="adprice">￥'+mycarresult[i].dailyRentCar+'/天</span>\n' +
                            '                <span class="adprice">￥'+mycarresult[i].weeklyRentCar+'/周</span>\n' +
                            '                <span class="adprice">￥'+mycarresult[i].monthlyRentCar+'/月</span>\n' +
                            '                </section>\n' +
                            '                <div class="clearfix"></div>\n' +
                            '                </li>\n' +
                            '\n' +
                            '                </a>');
					}


                }
			}

        }

        //获取门店汽车信息
        function getCars(id){

			var result=myajax("../CarTable/getCar/"+id,"get");
			mycarresult=result;
			var mycarlist=$("#mycarlist");
			mycarlist.empty();

			var mycity=$("#city option:selected").html();
			//console.log(result);
            //console.log("mycity:"+mycity);
			if(result.length==0)
			    mycarlist.append("<h3 align='center'>本门店暂无车辆可以租赁！！！</h3>")
			for(var i in result)
			{
			    mycarlist.append('<a onclick="enterOrder('+result[i].idCar+',\''+result[i].nameCar+'\',\''+result[i].imgCar+'\')">\n' +
                    '                <li>\n' +
                    '                <img src="'+result[i].imgCar+'" title="" alt="" />\n' +
                    '                <section class="list-left">\n' +
                    '                <h5 class="title">'+result[i].nameCar+'</h5>\n' +
                    '                <span class="cityname">'+result[i].describeCar+'</span>\n' +
                    '            <p class="catpath">'+result[i].carTypeCar+'&nbsp;&nbsp;'+mycity+'</p>\n' +
                    '            </section>\n' +
                    '            <section class="list-right">\n' +
                    '                <span class="adprice">￥'+result[i].dailyRentCar+'/天</span>\n' +
                    '                <span class="adprice">￥'+result[i].weeklyRentCar+'/周</span>\n' +
                    '                <span class="adprice">￥'+result[i].monthlyRentCar+'/月</span>\n' +
                    '                </section>\n' +
                    '                <div class="clearfix"></div>\n' +
                    '                </li>\n' +
                    '\n' +
                    '                </a>');

			}
			/*console.log(Math.ceil(result.length/3))
        	/!*$("#container .grid").style.height="300px";*!/
			console.log($("#container .grid").html())*/
            IFrameResize('myframe');
		}
		layui.use(['form','laydate','layer'], function(){
		  form = layui.form,laydate = layui.laydate,layer=layui.layer;


		  $(function () {
		      //初始化省市区
              area_init($("#province"));
              area_init($("#province2"));
			  //初始化汽车品牌
              var mybrandcar=myajax("../BrandCarTable/getBrandCar/","get");
              var brandcar=$("#brandCar");
              brandcar.empty();
              for(var i in mybrandcar.all)
              {
                  brandcar.append("<option data-tokens=\""+mybrandcar.all[i].brandBrandCar+"\">"+mybrandcar.all[i].brandBrandCar+"</option>");
              }
			  //营业网点中的   【进入店铺】功能
		      var mymap=$.cookie("mymap");
			  //console.log("mymap:",$.cookie("mymap"))
			  if(mymap!=undefined){

                  var result=myajax("../CarStoreTable//getCarStore/"+mymap,"get");

				  var city=$("#city");
				  city.empty();
				  for(var i in result.all)
				  {
                      city.append("<option value='"+result.all[i].idCarStore+"'>"+result.all[i].nameCarStore+"</option>");
				  }

				  city.val(mymap);
                  $("#province").val(""+result.all[0].addressCarStore);

                  form.render();
                  //加载门店汽车
                  getCars(mymap);
                  $.cookie("mymap", null, { expires: -1,path:'/'});
			  }

          })
			layer.msg('注意事项<br><br>1.查询相关车型时，可以选择取车门店；<br>2.点击汽车进行租车时，请填写取车地点<br>、还车地点、取车时间等相关信息；', {
				time: 20000, //20s后自动关闭
				btn: [ '知道了'],
                btnAlign: 'c'
			});
			

		  
		  //监听提交
		  form.on('submit(formDemo)', function(data){
		    //layer.msg(JSON.stringify(data.field));
		    var myorder=data.field;
		    myorder["idCarOrder"]=idCarOrder;
		    myorder["city"]=$("#city option:selected").html();
		    myorder["city2"]=$("#city2 option:selected").html();
		    myorder["nameCar"]=nameCar;
		    myorder["url"]=urlCar;
		    var mytime=myorder["time"].split(" ~ ");
		    myorder["getCarTimeOrder"]=mytime[0];
            myorder["returnCarTimeOrder"]=mytime[1];
            if($.cookie("myday")==undefined)
			{
			    layer.msg("取车时间和还车时间不能相同");
			}
			else {
                myorder["dayOrder"]=$.cookie("myday");
                $.cookie("myday", null, { expires: -1,path:'/'});

                //console.log(JSON.stringify(myorder));
                $.cookie("myorder", JSON.stringify(myorder), { expires: 1,path:'/'});
                location.href="../html/order.html";
			}


		    return false;
		  });
            form.on('select(city)', function(data){
                //console.log("city:"+data.value); //得到被选中的值
                //加载门店汽车
                getCars(data.value);
            });
            form.on('select(province)', function(data){
                //console.log(data.value.split("-")[2]); //得到被选中的值
                var result=myajax("../CarStoreTable/getCarStoreTable/"+data.value.split("-")[2],"get");

                var city=$("#city");
                city.empty();

                if(result.all.length==0)
                    city.append("<option value=''>无门店，请选择其他城市</option>");
                else{
                    for(var i in result.all)
                    {
                        city.append("<option value='"+result.all[i].idCarStore+"'>"+result.all[i].nameCarStore+"</option>");
                    }
                    form.render();

                    getCars(result.all[0].idCarStore);
				}


            });
            form.on('select(province2)', function(data){
                //console.log(data.value.split("-")[2]); //得到被选中的值
                var result=myajax("../CarStoreTable/getCarStoreTable/"+data.value.split("-")[2],"get");
                var city=$("#city2");
                city.empty();

                if(result.all.length==0)
                    city.append("<option value=''>无门店，请选择其他城市</option>");

                for(var i in result.all)
                {
                    city.append("<option value='"+result.all[i].idCarStore+"'>"+result.all[i].nameCarStore+"</option>");
                }
                form.render();
            });
            //日期时间范围
		  laydate.render({
		    elem: '#time'
		    ,type: 'datetime'
		    ,range: '~'
		    ,calendar: true
			  ,min:0
			  ,max:30
			  ,done: function(value, date, endDate){
				  var mydate=value.split(" ~ ");
				  var date1=Date.parse(mydate[0])
				  var date2=Date.parse(mydate[1])
				  if(date1==date2)
				      layer.msg("取车时间和还车时间不能相同")
				  else
				  {
                      var day=Math.ceil((date2-date1)/(24 * 3600 * 1000));
                      $.cookie("myday", day, { expires: 1,path:'/'});
                      layer.msg("租车时间为："+day+"天");
				  }
			  }
		  });
		});
	</script>
	<!-- Cars -->
	<div class="total-ads main-grid-border">

		<div class="container">
			
			
			<div class="ads-grid">
				<div class="side-bar col-md-3">
					
				
				<div class="range">
					<h3 class="sear-head">价格范围 /天</h3>
							<ul class="dropdown-menu6">
								<li>
									                
									<div id="slider-range"></div>							
										<input type="text" id="amount" style="border: 0; color: #ffffff; font-weight: normal;" />
									</li>			
							</ul>
							<!---->
							<script type="text/javascript" src="../js3/jquery-ui.js"></script>
							<script type='text/javascript'>//<![CDATA[ 
							$(window).load(function(){
							 $( "#slider-range" ).slider({
										range: true,
										min: 0,
										max: 1000,
										values: [ 0, 1000 ],
										slide: function( event, ui ) {
										    $( "#amount" ).val( "￥" + ui.values[ 0 ] + " - ￥" + ui.values[ 1 ] );
										}
							 });
							$( "#amount" ).val( "￥" + $( "#slider-range" ).slider( "values", 0 ) + " - ￥" + $( "#slider-range" ).slider( "values", 1 ) );

							});//]]>  

							</script>
							
				</div>
				<div class="brand-select">
					<h3 class="sear-head">汽车品牌</h3>
					<select id="brandCar" class="selectpicker" data-live-search="true">
						<option data-tokens="所有">所有品牌-ALL</option>
						<option data-tokens="Audi">奥迪-Audi</option>
						<option data-tokens="Bentley">宾利-Bentley</option>
						<option data-tokens="BMW">宝马-BMW</option>
						<option data-tokens="Chevrolet">雪佛兰-Chevrolet</option>
					</select>
				</div>

				<div class="brand-select">
					<button onclick="carSearch()" class="layui-btn layui-btn-fluid">查询相关车型</button>
				</div>
				<div class="featured-ads">
				</div>
				</div>
				<div class="ads-display col-md-9">
					<div class="wrapper">					
					<div class="bs-example bs-example-tabs" role="tabpanel" data-example-id="togglable-tabs">
					 
					  <div id="myTabContent" class="tab-content">
						<div role="tabpanel" class="tab-pane fade in active" id="home" aria-labelledby="home-tab">
						   <div>
												<div id="container">
								<div class="view-controls-list" id="viewcontrols">
									<label>view :</label>
									<a class="gridview"><i class="glyphicon glyphicon-th"></i></a>
									<a class="listview active"><i class="glyphicon glyphicon-th-list"></i></a>
								</div>
								
								<div class="clearfix"></div>
							<ul id="mycarlist" class="list">
								<!--<a onclick="enterOrder(1)">
									<li>
									<img src="https://image.1hai.cn/front/activity/20160909/lavida.jpg" title="" alt="" />
									<section class="list-left">
									<h5 class="title">大众朗逸或同组车型</h5>
									<span class="cityname">【随机分配如大众朗逸、标致308S、大众斯柯达明锐、现代朗动、大众宝来或类似车型】</span>
									<p class="catpath">自动|5座&nbsp;&nbsp;极速租车（大学城店）</p>
									</section>
									<section class="list-right">
										<span class="adprice">￥100/天</span>
										<span class="adprice">￥200/周</span>
										<span class="adprice">￥400/月</span>
									</section>
									<div class="clearfix"></div>
									</li> 
									
								</a>
								<a onclick="enterOrder(1)">
									<li>
										<img src="https://image.1hai.cn/images/cartype/20170818/2d1c3c37-a73d-43a0-b44b-558b04c4eccd.jpg?v=478e07969b59431bb9c6251bfef193af" title="" alt="" />
										<section class="list-left">
											<h5 class="title">斯柯达速派或同组车型</h5>
											<span class="cityname">【随机分配如一汽马自达全新阿特兹、大众斯柯达速派、标致508、标致508（非京牌）或类似车型】</span>
											<p class="catpath">自动|5座 &nbsp;&nbsp;极速租车（大学城店）</p>
										</section>
										<section class="list-right">
											<span class="adprice">￥120/天</span>
											<span class="adprice">￥220/周</span>
											<span class="adprice">￥420/月</span>
										</section>
										<div class="clearfix"></div>
									</li>

								</a>-->
								
								
								
								<div class="clearfix"></div>
								
								
							
								
							</ul>
						</div>
							</div>
						</div>
						
					  </div>
					</div>
				</div>
				</div>
				<div class="clearfix"></div>
			</div>
		</div>	
	</div>
</div>
</body>
</html>